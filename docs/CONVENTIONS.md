# Конвенции Кода и Архитектуры iSmart Platform

**Версия:** 1.0
**Дата:** 13.02.2026

## 1. Введение

Этот документ устанавливает единые стандарты и соглашения по написанию кода, структурированию данных и именованию файлов для проекта iSmart Platform. Соблюдение этих конвенций обязательно для всех участников проекта и направлено на повышение читаемости, поддерживаемости и согласованности кодовой базы.

## 2. Конвенции для PHP

1.  **Стиль Кода:**
    *   **PSR-12:** Весь PHP-код должен строго соответствовать стандарту [PSR-12](https://www.php-fig.org/psr/psr-12/).
    *   **Строгая типизация:** В начале каждого PHP-файла должна присутствовать директива `declare(strict_types=1);`.

2.  **Именование:**
    *   **Классы:** `PascalCase` (например, `PageDataLoader`).
    *   **Методы:** `camelCase` (например, `resolvePageId`).
    *   **Свойства:** `camelCase` (например, `$pageId`).
    *   **Константы:** `UPPER_CASE_SNAKE_CASE` (например, `DEFAULT_LANGUAGE`).

3.  **Архитектура:**
    *   **Dependency Injection:** Все зависимости должны передаваться через конструктор. Избегайте использования глобальных переменных или прямого создания объектов внутри классов.
    *   **Single Responsibility Principle:** Каждый класс должен иметь одну, четко определенную зону ответственности.
    *   **Stateless Services:** По возможности, сервисы в `/core` должны быть без состояния (stateless), обрабатывая входные данные и возвращая результат без сохранения промежуточного состояния.

4.  **Документирование:**
    *   **PHPDoc:** Все классы, методы и свойства должны быть документированы с использованием PHPDoc-блоков.
    *   **GRACE:** Применяйте адаптированную методологию GRACE, как описано в `TECHNICAL_SPEC.md` (контракты модулей и разметка блоков).

## 3. Конвенции для JSON

1.  **Форматирование:**
    *   **Отступы:** Используйте 4 пробела для отступов, чтобы обеспечить читаемость.
    *   **Валидность:** Все JSON-файлы должны быть валидными. Используйте `npm run validate:json` для проверки перед коммитом.

2.  **Именование Ключей:**
    *   Используйте `snake_case` для всех ключей в JSON-файлах (например, `page_title`, `contact_info`). Это обеспечивает консистентность и предсказуемость структуры данных.

3.  **Структура:**
    *   **Плоская структура секций:** В JSON-файлах страниц (`/data/json/{lang}/pages/*.json`) каждая секция является объектом в корневом массиве. Имя секции определяется полем `component`.
        ```json
        [
            {
                "component": "intro",
                "heading": "Добро пожаловать!",
                "text": "..."
            },
            {
                "component": "features",
                "items": [...] 
            }
        ]
        ```
    *   **Глобальные данные:** Данные, используемые на нескольких страницах (например, контакты, ссылки на соцсети), должны храниться в `global.json` и подключаться в шаблонах по мере необходимости.

## 4. Конвенции для Twig

1.  **Именование Файлов:**
    *   Используйте `kebab-case` для имен файлов шаблонов (например, `form-callback.twig`, `numbered-list.twig`).

2.  **Структура:**
    *   **Никакой логики:** Шаблоны Twig должны содержать только логику представления. Вся бизнес-логика должна быть в PHP.
    *   **Никакого контента:** Избегайте хардкодинга текста или других данных в шаблонах. Весь контент должен приходить из JSON-файлов.
    *   **Использование `include` и `embed`:** Переиспользуйте компоненты с помощью `include`. Для более сложной логики переопределения блоков используйте `embed`.

3.  **Стиль:**
    *   **Отступы:** Используйте 4 пробела.
    *   **Пробелы в операторах:** Ставьте пробелы вокруг операторов (`{{ page.title }}`, `{% if user.is_logged_in %}`).

## 5. Конвенции для JavaScript и CSS

1.  **JavaScript:**
    *   **Стиль:** Следуйте стандарту [Airbnb JavaScript Style Guide](https://github.com/airbnb/javascript).
    *   **Модульность:** Весь JS-код должен быть написан с использованием ES6-модулей (`import`/`export`).
    *   **Именование файлов:** `kebab-case` (например, `form-validator.js`).
    *   **Vanilla JS:** Предпочитайте нативный JavaScript. Использование jQuery допускается только для поддержки старых, унаследованных компонентов.

2.  **CSS (PostCSS):**
    *   **Методология:** Используйте методологию, близкую к **БЭМ**, для именования классов.
        *   Блок: `.section-name`
        *   Элемент: `.section-name__element`
        *   Модификатор: `.section-name--modifier`
    *   **Именование файлов:** `kebab-case` (например, `header.pcss`).
    *   **Вложенность:** Используйте плагин `postcss-nested` для вложенности, но не более 3 уровней, чтобы избежать излишней специфичности.
    *   **Переменные:** Используйте CSS Custom Properties для цветов, шрифтов и отступов.

## 6. Конвенции для Git

1.  **Именование веток:**
    *   `feature/{task-name}`: для новой функциональности (например, `feature/blog-module`).
    *   `fix/{issue-name}`: для исправления ошибок (например, `fix/form-submit-bug`).
    *   `docs/{document-name}`: для работы с документацией (например, `docs/update-conventions`).

2.  **Сообщения коммитов:**
    *   Следуйте формату **Conventional Commits** ([ссылка](https://www.conventionalcommits.org/)).
    *   **Формат:** `<type>(<scope>): <subject>`
    *   **Примеры:**
        *   `feat(contacts): add map section to contacts page`
        *   `fix(forms): correctly handle form validation errors`
        *   `docs(readme): update project setup instructions`
        *   `style(php): apply PSR-12 formatting`
        *   `refactor(core): simplify Application class`

Соблюдение этих конвенций поможет поддерживать высокое качество и технологическую целостность проекта iSmart Platform.
